<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hatchly - Prawn Egg Hatch Prediction System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>

    <div class="page active" id="authPage">
        <div class="auth-container">
            <div class="forms-container" id="formsContainer">
             
                <div class="form-section">
                    <div class="form-content">
                        <div class="branding">
                            <div class="logo-placeholder">
                                <img src="{{ url_for('static', filename='images/Logo.png') }}" alt="Hatchly Logo" class="logo-img" id="loginLogo">
                            </div>
                            <h1><span class="welcome">Welcome!</span> to Hatchly</h1>
                            <p class="subtitle">Sign in to continue</p>
                        </div>

                      <div class="form-group">
                            <label>Username</label>
                            <input type="text" id="loginEmail" placeholder="Enter your username">
                            <div class="error" id="loginEmailError">Please enter your username</div>
                        </div>

                        <div class="form-group">
                            <label>Password</label>
                            <div class="password-container">
                                <input type="password" id="loginPassword" placeholder="Enter your password">
                                <span class="toggle-password" onclick="togglePasswordVisibility('loginPassword', this)">Show</span>
                            </div>
                            <div class="error" id="loginPasswordError">Please enter your password</div>
                            <div class="error" id="loginCredentialsError">Wrong email or password. Please try again.</div>
                        </div>

                        <button class="btn" onclick="handleLogin()">LOG IN</button>

                        <div class="switch-text">
                            Don't have an account? <span class="switch-link" onclick="toggleForm()">Sign Up.</span>
                        </div>
                    </div>
                </div>

            
                <div class="form-section">
                    <div class="form-content">
                        <div class="branding">
                            <h1>Create a new account</h1>
                        </div>

                        <div class="form-group">
                            <label>Name</label>
                            <input type="text" id="signupName" placeholder="Enter your name">
                            <div class="error" id="signupNameError">Please enter your name</div>
                        </div>

                        <div class="form-group">
                            <label>Username</label>
                            <input type="text" id="signupEmail" placeholder="Enter a username">
                            <div class="error" id="signupEmailError">Please enter a username</div>
                        </div>

                        <div class="form-group">
                            <label>Password</label>
                            <div class="password-container">
                                <input type="password" id="signupPassword" placeholder="Enter your password">
                                <span class="toggle-password" onclick="togglePasswordVisibility('signupPassword', this)">Show</span>
                            </div>
                            <div class="error" id="signupPasswordError">Password must be at least 6 characters</div>
                        </div>

                        <button class="btn" onclick="handleSignup()">SIGN UP</button>

                        <div class="switch-text">
                            Already have an account? <span class="switch-link" onclick="toggleForm()">Log In.</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- DASHBOARD PAGE -->
<div class="page" id="dashboardPage">
    <div class="logo-top-left" onclick="showPage('dashboardPage')" style="cursor: pointer;">
    <img src="{{ url_for('static', filename='images/Logo.png') }}" alt="Hatchly Logo" class="logo-img">
</div>
    <div class="menu-container">
        <button class="btn menu-btn" onclick="toggleMenu()">‚ò∞ Menu</button>
        <div class="menu-dropdown" id="menuDropdownDashboard">
            <div class="menu-header">
                <p class="menu-greeting">Hello <span class="user-name-display">User</span></p>
                <p class="menu-welcome">Welcome to Hatchly</p>
            </div>
            <div class="menu-items">
                <a href="#" onclick="showPage('dashboardPage'); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> Dashboard</a>  
                <a href="#" onclick="showChangePassword(); return false;"><img src="{{ url_for('static', filename='images/menu-change.png') }}"> Change Password</a>
                <a href="#" onclick="showPage('selectPrawnPage'); return false;"> <img src="{{ url_for('static', filename='images/menu-list.png') }}">List of Prawns</a>
                <a href="#" onclick="showPage('locationSetupPage'); return false;"><img src="{{ url_for('static', filename='images/menu-location.png') }}">Location Setup</a>
                <a href="#" onclick="obShow(); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> How to Use</a>
                <a href="#" onclick="handleLogout(); return false;"><img src="{{ url_for('static', filename='images/menu-logout.png') }}"> Logout</a>
            </div>
        </div>
    </div>

    <div class="dashboard-container">
        <h1 class="dashboard-title">Hatchly Dashboard</h1>
        
        <!-- Quick Stats -->
        <div class="dashboard-stats">
            <div class="stat-card">
                <div class="stat-icon"><img src="{{url_for('static', filename='images/Total prawn.png')}}"></div>
                <div class="stat-content">
                    <h3 id="totalPrawns">0</h3>
                    <p>Total Prawns</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><img src="{{url_for('static', filename='images/Total Prediction.png')}}"></div>
                <div class="stat-content">
                    <h3 id="totalPredictions">0</h3>
                    <p>Total Predictions</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><img src="{{url_for('static', filename='images/hatching.png')}}"></div>
                <div class="stat-content">
                    <h3 id="upcomingHatches">0</h3>
                    <p>Hatching Soon</p>
                </div>
            </div>
        </div>

        <!-- Upcoming Hatches Banner -->
        <div class="dashboard-section">
            <h2><img src="{{url_for('static', filename='images/Upcoming.png')}}"> Upcoming Hatches</h2>
            <div id="upcomingHatchesList" class="upcoming-hatches-list">
                <p class="loading-text">Loading...</p>
            </div>
        </div>

        <!-- Latest Predictions -->
        <div class="dashboard-section">
            <h2><img src="{{url_for('static', filename='images/Latest.png')}}">Latest Predictions</h2>
            <div id="latestPredictionsList" class="latest-predictions-grid">
                <p class="loading-text">Loading...</p>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="dashboard-actions">
            <button class="btn" onclick="showPage('registerPrawnPage')">Register New Prawn</button>
            <button class="btn btn-outline" onclick="showPage('selectPrawnPage')"> View All Prawns</button>
        </div>
    </div>
</div>


    <div class="page" id="registerPrawnPage">
        <div class="logo-top-left" onclick="showPage('dashboardPage')" style="cursor: pointer;">
    <img src="{{ url_for('static', filename='images/Logo.png') }}" alt="Hatchly Logo" class="logo-img">
</div>
        <div class="menu-container">
            <button class="btn menu-btn" onclick="toggleMenu()">‚ò∞ Menu</button>
            <div class="menu-dropdown" id="menuDropdown2">
                <div class="menu-header">
                    <p class="menu-greeting">Hello <span class="user-name-display">User</span></p>
                    <p class="menu-welcome">Welcome to Hatchly</p>
                </div>
                <div class="menu-items">
                <a href="#" onclick="showPage('dashboardPage'); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> Dashboard</a>  
                <a href="#" onclick="showChangePassword(); return false;"><img src="{{ url_for('static', filename='images/menu-change.png') }}"> Change Password</a>
                <a href="#" onclick="showPage('selectPrawnPage'); return false;"> <img src="{{ url_for('static', filename='images/menu-list.png') }}">List of Prawns</a>
                <a href="#" onclick="showPage('locationSetupPage'); return false;"><img src="{{ url_for('static', filename='images/menu-location.png') }}">Location Setup</a>
                <a href="#" onclick="obShow(); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> How to Use</a>
                <a href="#" onclick="handleLogout(); return false;"><img src="{{ url_for('static', filename='images/menu-logout.png') }}"> Logout</a>
            </div>
            </div>
        </div>
        <div class="register-container">
            <div class="register-header">
                <h2>Register Prawn</h2>
            </div>

            <div class="form-group">
                <label>Name</label>
                <input type="text" id="prawnName" placeholder="Enter your prawn's name" autocomplete="off">
                <div class="error" id="prawnNameError">Please enter prawn name</div>
            </div>

            <div class="form-group">
                <label>Location</label>
                <select id="prawnLocation" class="form-select">
                    <option value="">-- Select Location --</option>
                </select>
                <div class="error" id="prawnLocationError">Please select a location</div>
            </div>

            <button class="btn btn-outline" onclick="handleSavePrawn()">SAVE</button>
<button class="btn btn-outline" onclick="showPage('locationSetupPage')" style="margin-top: 10px;">LOCATION SETUP</button>
<button class="btn btn-outline" onclick="goBackFromLocationSetup()" style="margin-top: 20px;">BACK</button>
        </div>
    </div>


    <div class="page" id="selectPrawnPage">
        <div class="logo-top-left" onclick="showPage('dashboardPage')" style="cursor: pointer;">
    <img src="{{ url_for('static', filename='images/Logo.png') }}" alt="Hatchly Logo" class="logo-img">
</div>
        <div class="menu-container">
            <button class="btn menu-btn" onclick="toggleMenu()">‚ò∞ Menu</button>
            <div class="menu-dropdown" id="menuDropdown3">
                <div class="menu-header">
                    <p class="menu-greeting">Hello <span class="user-name-display">User</span></p>
                    <p class="menu-welcome">Welcome to Hatchly</p>
                </div>
            <div class="menu-items">
                <a href="#" onclick="showPage('dashboardPage'); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> Dashboard</a>  
                <a href="#" onclick="showChangePassword(); return false;"><img src="{{ url_for('static', filename='images/menu-change.png') }}"> Change Password</a>
                <a href="#" onclick="showPage('selectPrawnPage'); return false;"> <img src="{{ url_for('static', filename='images/menu-list.png') }}">List of Prawns</a>
                <a href="#" onclick="showPage('locationSetupPage'); return false;"><img src="{{ url_for('static', filename='images/menu-location.png') }}">Location Setup</a>
                <a href="#" onclick="obShow(); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> How to Use</a>
                <a href="#" onclick="handleLogout(); return false;"><img src="{{ url_for('static', filename='images/menu-logout.png') }}"> Logout</a>
            </div>
            </div>
        </div>
        <div class="select-container">
            <div class="register-header">
                <h2>Select Prawn</h2>
            </div>

            <div class="location-filter-row">
                <label>Filter by Location:</label>
                <select id="locationFilter" class="form-select" onchange="filterPrawnsByLocation()">
                    <option value="">All Prawns</option>
                </select>
            </div>

            <div class="prawnListContainer" id="prawnListContainer">

            </div>

            <button class="btn btn-outline" onclick="showPage('dashboardPage')" style="margin-top: 30px;">BACK TO HOME</button>
        </div>
    </div>


    <div class="page" id="imageSelectionPage">
        <div class="logo-top-left" onclick="showPage('dashboardPage')" style="cursor: pointer;">
    <img src="{{ url_for('static', filename='images/Logo.png') }}" alt="Hatchly Logo" class="logo-img">
</div>
        <div class="menu-container">
            <button class="btn menu-btn" onclick="toggleMenu()">‚ò∞ Menu</button>
            <div class="menu-dropdown" id="menuDropdown4">
                <div class="menu-header">
                    <p class="menu-greeting">Hello <span class="user-name-display">User</span></p>
                    <p class="menu-welcome">Welcome to Hatchly</p>
                </div>
            <div class="menu-items">
                <a href="#" onclick="showPage('dashboardPage'); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> Dashboard</a>  
                <a href="#" onclick="showChangePassword(); return false;"><img src="{{ url_for('static', filename='images/menu-change.png') }}"> Change Password</a>
                <a href="#" onclick="showPage('selectPrawnPage'); return false;"> <img src="{{ url_for('static', filename='images/menu-list.png') }}">List of Prawns</a>
                <a href="#" onclick="showPage('locationSetupPage'); return false;"><img src="{{ url_for('static', filename='images/menu-location.png') }}">Location Setup</a>
                <a href="#" onclick="obShow(); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> How to Use</a>
                <a href="#" onclick="handleLogout(); return false;"><img src="{{ url_for('static', filename='images/menu-logout.png') }}"> Logout</a>
            </div>
            </div>
        </div>
        <div class="select-container">
            <div class="register-header">
                <div class="prawn-info-header">
                    <h2 id="selectedPrawnName">Prawn Name</h2>
                    <p id="selectedPrawnLocation">Location: --</p>
                    <div class="prawn-quick-actions">
                        <button class="prawn-quick-btn" onclick="showRenamePrawnModal(selectedPrawn)">
                            <img src="{{ url_for('static', filename='images/rename.png') }}">
                        </button>
                        <button class="prawn-quick-btn" onclick="showTransferPrawnModal(selectedPrawn)">
                            <img src="{{ url_for('static', filename='images/changeloc.png') }}">
                        </button>
                    </div>
                </div>
            </div>

            <button class="btn btn-outline" onclick="showPage('capturePage')">CAPTURE IMAGE</button>
            <button class="btn btn-outline" onclick="triggerFileUpload()">UPLOAD IMAGE</button>
            <button class="btn" onclick="showHistoryPage()">HISTORY</button>
            <button class="btn btn-outline" onclick="showPage('selectPrawnPage')" style="margin-top: 20px;">BACK</button>
            <input type="file" id="fileInput" accept="image/*" style="display: none;" onchange="handleFileUpload(event)">
        </div>
    </div>


    <div class="page" id="capturePage">
        <div class="logo-top-left" onclick="showPage('dashboardPage')" style="cursor: pointer;">
    <img src="{{ url_for('static', filename='images/Logo.png') }}" alt="Hatchly Logo" class="logo-img">
</div>
        <div class="menu-container">
            <button class="btn menu-btn" onclick="toggleMenu()">‚ò∞ Menu</button>
            <div class="menu-dropdown" id="menuDropdown5">
                <div class="menu-header">
                    <p class="menu-greeting">Hello <span class="user-name-display">User</span></p>
                    <p class="menu-welcome">Welcome to Hatchly</p>
                </div>
                <div class="menu-items">
                <a href="#" onclick="showPage('dashboardPage'); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> Dashboard</a>  
                <a href="#" onclick="showChangePassword(); return false;"><img src="{{ url_for('static', filename='images/menu-change.png') }}"> Change Password</a>
                <a href="#" onclick="showPage('selectPrawnPage'); return false;"> <img src="{{ url_for('static', filename='images/menu-list.png') }}">List of Prawns</a>
                <a href="#" onclick="showPage('locationSetupPage'); return false;"><img src="{{ url_for('static', filename='images/menu-location.png') }}">Location Setup</a>
                <a href="#" onclick="obShow(); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> How to Use</a>
                <a href="#" onclick="handleLogout(); return false;"><img src="{{ url_for('static', filename='images/menu-logout.png') }}"> Logout</a>
            </div>
            </div>
        </div>
        <div class="capture-container">
            <div class="register-header">
                <div class="prawn-info-header">
                    <h2 class="selected-prawn-name-display">Prawn Name</h2>
                    <p class="selected-prawn-location-display">Location: --</p>
                </div>
            </div>

            <div class="image-preview-container">
                <!-- LEFT BOX: Live camera feed -->
                <div class="image-box">
                    <!-- Placeholder shown before user selects a camera (Fix #5) -->
                    <div id="cameraPlaceholder" class="camera-placeholder">
                        <span>üì∑</span>
                        <p>Select a camera source below to start</p>
                    </div>
                    <!-- Loading indicator shown while camera initialises (Fix #6) -->
                    <div id="cameraLoading" class="camera-loading" style="display:none;">
                        <div class="spinner"></div>
                        <p>Starting camera...</p>
                    </div>
                    <!-- Live streams -->
                    <video id="video" autoplay playsinline style="display: none;"></video>
                    <img id="rpiStream" style="display: none;">
                    <canvas id="canvas" style="display: none;"></canvas>
                    <!-- Captured image stays in left box for reference -->
                    <img id="capturedImage" style="display: none;">
                </div>

                <!-- RIGHT BOX: Static preview of captured image (Fix #7) -->
                <div class="image-box preview-box">
                    <div id="previewPlaceholder" class="camera-placeholder">
                        <span>üñºÔ∏è</span>
                        <p>Captured image will appear here</p>
                    </div>
                    <img id="previewImage" src="" alt="Preview will appear here" style="display:none;"
                         onload="this.style.display='block'; document.getElementById('previewPlaceholder').style.display='none';">
                </div>
            </div>

<!-- Camera source selector buttons -->
        <div class="camera-source-selector">
            <button class="btn btn-outline active-camera" id="useLocalCamera" onclick="switchToLocalCamera()">
                Use Local Camera
            </button>
            <button class="btn btn-outline" id="useRPiCamera" onclick="switchToRPiCamera()">
                Use Prawn Camera
            </button>
        </div>

            <div class="button-group">
                <button class="btn" onclick="showPage('imageSelectionPage')">BACK</button>
                <button class="btn btn-orange" id="captureBtn" onclick="captureImage()">CAPTURE</button>
            </div>
        </div>
    </div>

    <div class="page" id="predictPage">
        <div class="logo-top-left" onclick="showPage('dashboardPage')" style="cursor: pointer;">
    <img src="{{ url_for('static', filename='images/Logo.png') }}" alt="Hatchly Logo" class="logo-img">
</div>
        <div class="menu-container">
            <button class="btn menu-btn" onclick="toggleMenu()">‚ò∞ Menu</button>
            <div class="menu-dropdown" id="menuDropdown6">
                <div class="menu-header">
                    <p class="menu-greeting">Hello <span class="user-name-display">User</span></p>
                    <p class="menu-welcome">Welcome to Hatchly</p>
                </div>
                <div class="menu-items">
                <a href="#" onclick="showPage('dashboardPage'); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> Dashboard</a>  
                <a href="#" onclick="showChangePassword(); return false;"><img src="{{ url_for('static', filename='images/menu-change.png') }}"> Change Password</a>
                <a href="#" onclick="showPage('selectPrawnPage'); return false;"> <img src="{{ url_for('static', filename='images/menu-list.png') }}">List of Prawns</a>
                <a href="#" onclick="showPage('locationSetupPage'); return false;"><img src="{{ url_for('static', filename='images/menu-location.png') }}">Location Setup</a>
                <a href="#" onclick="obShow(); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> How to Use</a>
                <a href="#" onclick="handleLogout(); return false;"><img src="{{ url_for('static', filename='images/menu-logout.png') }}"> Logout</a>
            </div>
            </div>
        </div>
        <div class="capture-container">
            <div class="register-header">
                <div class="prawn-info-header">
                    <h2 class="selected-prawn-name-display">Prawn Name</h2>
                    <p class="selected-prawn-location-display">Location: --</p>
                </div>
            </div>

            <div class="image-preview-container">
                <div class="image-box">
                    <img id="uploadedImage" src="" alt="Uploaded image">
                </div>
                <div class="image-box preview-box">
                    <div id="predictionResult" class="prediction-result">
                        <div id="loadingSpinner" style="display: none;">
                            <div class="spinner"></div>
                            <p>Analyzing image...</p>
                        </div>
                        <div id="resultContent" style="display: none;">
                            <h3>Prediction Result</h3>
                            <p class="result-days"><span id="daysResult">--</span> days until hatch</p>
                            <p class="result-confidence">Confidence: <span id="confidenceResult">--</span>%</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button class="btn" onclick="tryAgain()">BACK</button>
                <button class="btn btn-orange" id="predictBtn" onclick="predictHatchDate()">PREDICT RESULT</button>
            </div>
        </div>
    </div>


    <div class="page" id="historyPage">
        <div class="logo-top-left" onclick="showPage('dashboardPage')" style="cursor: pointer;">
    <img src="{{ url_for('static', filename='images/Logo.png') }}" alt="Hatchly Logo" class="logo-img">
</div>
        <div class="menu-container">
            <button class="btn menu-btn" onclick="toggleMenu()">‚ò∞ Menu</button>
            <div class="menu-dropdown" id="menuDropdown7">
                <div class="menu-header">
                    <p class="menu-greeting">Hello <span class="user-name-display">User</span></p>
                    <p class="menu-welcome">Welcome to Hatchly</p>
                </div>
                <div class="menu-items">
                <a href="#" onclick="showPage('dashboardPage'); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> Dashboard</a>  
                <a href="#" onclick="showChangePassword(); return false;"><img src="{{ url_for('static', filename='images/menu-change.png') }}"> Change Password</a>
                <a href="#" onclick="showPage('selectPrawnPage'); return false;"> <img src="{{ url_for('static', filename='images/menu-list.png') }}">List of Prawns</a>
                <a href="#" onclick="showPage('locationSetupPage'); return false;"><img src="{{ url_for('static', filename='images/menu-location.png') }}">Location Setup</a>
                <a href="#" onclick="obShow(); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> How to Use</a>
                <a href="#" onclick="handleLogout(); return false;"><img src="{{ url_for('static', filename='images/menu-logout.png') }}"> Logout</a>
            </div>
            </div>
        </div>
        <div class="history-container">
            <h2 class="history-title"><span id="prawnNameTitle">Prawn Name</span> Logs</h2>
            
            <div class="logs-container" id="logsContainer">

            </div>

            <button class="btn" onclick="showPage('imageSelectionPage')" style="max-width: 300px; margin: 30px auto 0; display: block;">BACK</button>
        </div>
    </div>


    <div class="modal" id="imageModal" onclick="closeImageModal()">
        <span class="close-modal">&times;</span>
        <img class="modal-content" id="modalImage">
    </div>



<div class="page" id="changePasswordPage">
    <div class="logo-top-left" onclick="showPage('dashboardPage')" style="cursor: pointer;">
    <img src="{{ url_for('static', filename='images/Logo.png') }}" alt="Hatchly Logo" class="logo-img">
</div>
    <div class="menu-container">
        <button class="btn menu-btn" onclick="toggleMenu()">‚ò∞ Menu</button>
        <div class="menu-dropdown" id="menuDropdown8">
            <div class="menu-header">
                <p class="menu-greeting">Hello <span class="user-name-display">User</span></p>
                <p class="menu-welcome">Welcome to Hatchly</p>
            </div>
            <div class="menu-items">
                <a href="#" onclick="showPage('dashboardPage'); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> Dashboard</a>  
                <a href="#" onclick="showChangePassword(); return false;"><img src="{{ url_for('static', filename='images/menu-change.png') }}"> Change Password</a>
                <a href="#" onclick="showPage('selectPrawnPage'); return false;"> <img src="{{ url_for('static', filename='images/menu-list.png') }}">List of Prawns</a>
                <a href="#" onclick="showPage('locationSetupPage'); return false;"><img src="{{ url_for('static', filename='images/menu-location.png') }}">Location Setup</a>
                <a href="#" onclick="obShow(); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> How to Use</a>
                <a href="#" onclick="handleLogout(); return false;"><img src="{{ url_for('static', filename='images/menu-logout.png') }}"> Logout</a>
            </div>
        </div>
    </div>
    
    <div class="register-container">
        <div class="change-password-header">
            <h2>Change Password</h2>
        </div>

        <div class="form-group">
            <label>Current Password</label>
            <div class="password-container">
                <input type="password" id="currentPassword" placeholder="Enter current password">
                <span class="toggle-password" onclick="togglePasswordVisibility('currentPassword', this)">Show</span>
            </div>
            <div class="error" id="currentPasswordError">Please enter your current password</div>
        </div>

        <div class="form-group">
            <label>New Password</label>
            <div class="password-container">
                <input type="password" id="newPassword" placeholder="Enter new password (min 6 characters)">
                <span class="toggle-password" onclick="togglePasswordVisibility('newPassword', this)">Show</span>
            </div>
            <div class="error" id="newPasswordError">Password must be at least 6 characters</div>
        </div>

        <div class="form-group">
            <label>Confirm New Password</label>
            <div class="password-container">
                <input type="password" id="confirmPassword" placeholder="Confirm new password">
                <span class="toggle-password" onclick="togglePasswordVisibility('confirmPassword', this)">Show</span>
            </div>
            <div class="error" id="confirmPasswordError">Passwords do not match</div>
        </div>

        <button class="btn btn-otline" onclick="handleChangePassword()">CHANGE PASSWORD</button>
        <button class="btn btn-outline" onclick="showPage('dashboardPage')" style="margin-top: 10px;">CANCEL</button>
    </div>
</div>

<div class="modal" id="deletePrawnModal" onclick="closeDeleteModal(event)">
    <div class="delete-modal-content" onclick="event.stopPropagation()">
        <span class="close-modal" onclick="closeDeleteModal()">&times;</span>
        <h2>‚ö†Ô∏è Delete Prawn</h2>
        <p class="delete-warning">Are you sure you want to delete "<span id="deletePrawnName"></span>"?</p>
        <p class="delete-info">This action cannot be undone. All prediction history for this prawn will also be deleted.</p>
        
        <div class="form-group">
            <label>Enter your password to confirm:</label>
            <div class="password-container">
                <input type="password" id="deleteConfirmPassword" placeholder="Enter your password">
                <span class="toggle-password" onclick="togglePasswordVisibility('deleteConfirmPassword', this)">Show</span>
            </div>
            <div class="error" id="deletePasswordError">Password is incorrect</div>
        </div>

        <div class="button-group">
            <button class="btn btn-outline" onclick="closeDeleteModal()">CANCEL</button>
            <button class="btn btn-delete" onclick="confirmDeletePrawn()">DELETE PRAWN</button>
        </div>
    </div>
</div>

<!-- RENAME PRAWN MODAL -->
<div class="modal" id="renamePrawnModal" onclick="closeRenamePrawnModal(event)">
    <div class="delete-modal-content" onclick="event.stopPropagation()">
        <span class="close-modal" onclick="closeRenamePrawnModal()">&times;</span>
        <h2>Rename Prawn</h2>
        <p class="delete-warning">Current name: <strong><span id="renamePrawnCurrentName"></span></strong></p>
        <div class="form-group">
            <label>New Name</label>
            <input type="text" id="renamePrawnInput" placeholder="Enter new prawn name" autocomplete="off">
            <div class="error" id="renamePrawnError">Please enter a name</div>
        </div>
        <div class="button-group">
            <button class="btn btn-outline" onclick="closeRenamePrawnModal()">CANCEL</button>
            <button class="btn btn-orange" onclick="confirmRenamePrawn()">SAVE</button>
        </div>
    </div>
</div>

<!-- CHANGE LOCATION MODAL -->
<div class="modal" id="transferPrawnModal" onclick="closeTransferPrawnModal(event)">
    <div class="delete-modal-content" onclick="event.stopPropagation()">
        <span class="close-modal" onclick="closeTransferPrawnModal()">&times;</span>
        <h2>Change Location</h2>
        <p class="delete-warning">"<span id="transferPrawnName"></span>"</p>
        <p class="transfer-current-location">Current: <strong><span id="transferCurrentLocation"></span></strong></p>
        <div class="form-group" style="margin-top: 16px;">
            <label>Move to</label>
            <select id="transferLocationSelect" class="form-select">
                <option value="">-- Select Location --</option>
            </select>
            <div class="error" id="transferLocationError">Please select a location</div>
        </div>
        <div class="button-group">
            <button class="btn btn-outline" onclick="closeTransferPrawnModal()">CANCEL</button>
            <button class="btn btn-orange" onclick="confirmTransferPrawn()">CHANGE</button>
        </div>
    </div>
</div>

<!-- LOCATION SETUP PAGE -->
<div class="page" id="locationSetupPage">
    <div class="logo-top-left" onclick="showPage('dashboardPage')" style="cursor: pointer;">
    <img src="{{ url_for('static', filename='images/Logo.png') }}" alt="Hatchly Logo" class="logo-img">
</div>
    <div class="menu-container">
        <button class="btn menu-btn" onclick="toggleMenu()">‚ò∞ Menu</button>
        <div class="menu-dropdown" id="menuDropdownLocation">
            <div class="menu-header">
                <p class="menu-greeting">Hello <span class="user-name-display">User</span></p>
                <p class="menu-welcome">Welcome to Hatchly</p>
            </div>
            <div class="menu-items">
                <a href="#" onclick="showPage('dashboardPage'); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> Dashboard</a>  
                <a href="#" onclick="showChangePassword(); return false;"><img src="{{ url_for('static', filename='images/menu-change.png') }}"> Change Password</a>
                <a href="#" onclick="showPage('selectPrawnPage'); return false;"> <img src="{{ url_for('static', filename='images/menu-list.png') }}">List of Prawns</a>
                <a href="#" onclick="showPage('locationSetupPage'); return false;"><img src="{{ url_for('static', filename='images/menu-location.png') }}">Location Setup</a>
                <a href="#" onclick="obShow(); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> How to Use</a>
                <a href="#" onclick="handleLogout(); return false;"><img src="{{ url_for('static', filename='images/menu-logout.png') }}"> Logout</a>
            </div>
        </div>
    </div>
    <div class="register-container">
        <div class="register-header">
            <h2>Location Setup</h2>
        </div>

        <div class="form-group">
            <label>Add New Location</label>
            <div class="location-input-row">
                <input type="text" id="newLocationName" placeholder="Enter location name"autocomplete="off">
                <button class="btn-add" onclick="handleAddLocation()">ADD</button>
            </div>
            <div class="error" id="locationNameError">Please enter a location name</div>
        </div>

        <div class="location-list-header">
            <h3>Your Locations</h3>
        </div>
        <div id="locationListContainer" class="location-list-container">
            <p style="text-align: center; color: #666;">Loading...</p>
        </div>

        <button class="btn btn-outline" onclick="goBackFromLocationSetup()" style="margin-top: 20px;">BACK</button>
    </div>
</div>

<!-- RENAME LOCATION MODAL -->
<div class="modal" id="renameLocationModal" onclick="closeRenameModal(event)">
    <div class="delete-modal-content" onclick="event.stopPropagation()">
        <span class="close-modal" onclick="closeRenameModal()">&times;</span>
        <h2>‚úèÔ∏è Rename Location</h2>
        <div class="form-group">
            <label>New Name</label>
            <input type="text" id="renameLocationInput" placeholder="Enter new location name" autocomplete="off">
            <div class="error" id="renameLocationError">Please enter a name</div>
        </div>
        <div class="button-group">
            <button class="btn btn-outline" onclick="closeRenameModal()">CANCEL</button>
            <button class="btn btn-orange" onclick="confirmRenameLocation()">RENAME</button>
        </div>
    </div>
</div>

    <script src="{{ url_for('static', filename='js/scripts.js') }}"></script>
    <script>
        const deleteIconUrl = "{{ url_for('static', filename='images/delete.png') }}";
    </script>

<div id="onboardingOverlay" style="display:none;">
  <div id="onboardingBackdrop"></div>
  <div id="onboardingModal">

    <div id="onboardingDots">
      <span class="ob-dot active" data-step="0"></span>
      <span class="ob-dot" data-step="1"></span>
      <span class="ob-dot" data-step="2"></span>
      <span class="ob-dot" data-step="3"></span>
      <span class="ob-dot" data-step="4"></span>
    </div>

    <div id="onboardingSlides">

      <!-- SLIDE 0 ‚îÄ Welcome -->
      <div class="ob-slide active" data-step="0">
        <div class="ob-icon-wrap">
          <div class="ob-shrimp-icon">ü¶ê</div>
          <div class="ob-ripple r1"></div>
          <div class="ob-ripple r2"></div>
          <div class="ob-ripple r3"></div>
        </div>
        <h2 class="ob-title">Welcome to <span>Hatchly!</span></h2>
        <p class="ob-desc">Your smart prawn egg hatch prediction system. Let's walk you through the quick setup ‚Äî it only takes a minute!</p>
        <div class="ob-badge">First-time setup üéâ</div>
      </div>

      <!-- SLIDE 1 ‚îÄ Register Prawn -->
      <div class="ob-slide" data-step="1">
        <div class="ob-step-num">Step 1</div>
        <div class="ob-icon-wrap small"><div class="ob-emoji">üìã</div></div>
        <h2 class="ob-title">Register Your <span>Prawn</span></h2>
        <p class="ob-desc">Start by registering your first prawn. You'll also need to add a location (aquarium) before saving.</p>
        <div class="ob-steps-mini">
          <div class="ob-mini-step"><span class="ob-mini-num">1</span><span>Click <em>Register New Prawn</em> from the Dashboard</span></div>
          <div class="ob-mini-step"><span class="ob-mini-num">2</span><span>Enter your prawn's name</span></div>
          <div class="ob-mini-step"><span class="ob-mini-num">3</span><span>Click <em>LOCATION SETUP</em> to add a new location</span></div>
          <div class="ob-mini-step"><span class="ob-mini-num">4</span><span>Type the location name ‚Üí click <em>ADD</em> ‚Üí click <em>BACK</em></span></div>
          <div class="ob-mini-step"><span class="ob-mini-num">5</span><span>Choose the location you just created ‚Üí click <em>SAVE</em></span></div>
        </div>
      </div>

      <!-- SLIDE 2 ‚îÄ Select Prawn -->
      <div class="ob-slide" data-step="2">
        <div class="ob-step-num">Step 2</div>
        <div class="ob-icon-wrap small"><div class="ob-emoji">üëÜ</div></div>
        <h2 class="ob-title">Select Your <span>Prawn</span></h2>
        <p class="ob-desc">After saving you'll land on the <strong>Select Prawn</strong> page. Tap the prawn card you just created to open its options.</p>
        <div class="ob-visual-card">
          <div class="ob-fake-card">
            <div class="ob-fake-card-left">
              <div class="ob-fake-title">My Prawn</div>
              <div class="ob-fake-sub">üìç Aquarium A</div>
            </div>
            <div class="ob-fake-arrow">‚Ä∫</div>
          </div>
          <div class="ob-tap-hint">‚Üê tap this card!</div>
        </div>
      </div>

      <!-- SLIDE 3 ‚îÄ Capture / Upload -->
      <div class="ob-slide" data-step="3">
        <div class="ob-step-num">Step 3</div>
        <div class="ob-icon-wrap small"><div class="ob-emoji">üì∏</div></div>
        <h2 class="ob-title">Get a <span>Prediction</span></h2>
        <p class="ob-desc">Inside the prawn options page, capture a live photo or upload an existing image of the prawn eggs.</p>
        <div class="ob-two-options">
          <div class="ob-option">
            <div class="ob-option-icon">üì∑</div>
            <div class="ob-option-label">CAPTURE IMAGE</div>
            <div class="ob-option-hint">Use your phone camera or the RPi prawn camera</div>
          </div>
          <div class="ob-option-divider">or</div>
          <div class="ob-option">
            <div class="ob-option-icon">üñºÔ∏è</div>
            <div class="ob-option-label">UPLOAD IMAGE</div>
            <div class="ob-option-hint">Choose a photo from your gallery</div>
          </div>
        </div>
        <p class="ob-desc small">Then tap <strong>PREDICT RESULT</strong> to get the estimated days until hatch!</p>
      </div>

      <!-- SLIDE 4 ‚îÄ History & Dashboard -->
      <div class="ob-slide" data-step="4">
        <div class="ob-step-num">Step 4</div>
        <div class="ob-icon-wrap small"><div class="ob-emoji">üìä</div></div>
        <h2 class="ob-title">Track Your <span>History</span></h2>
        <p class="ob-desc">All predictions are saved automatically. Tap <strong>HISTORY</strong> from the prawn options page to review all logs.</p>
        <div class="ob-history-preview">
          <div class="ob-fake-log">
            <div class="ob-fake-log-info">
              <div class="ob-fake-log-date">üìÖ Feb 26, 2026 ¬∑ 09:41 AM</div>
              <div class="ob-fake-log-days">üïê <strong>7 days</strong> before hatching</div>
            </div>
            <div class="ob-fake-log-img">ü¶ê</div>
          </div>
        </div>
        <div class="ob-dashboard-note">üí° Your <strong>Dashboard</strong> shows upcoming hatches &amp; latest predictions at a glance!</div>
      </div>

    </div><!-- /slides -->

    <div id="onboardingNav">
      <button id="obPrevBtn" class="ob-btn ob-btn-ghost" onclick="obPrev()">‚Üê Back</button>
      <button id="obNextBtn" class="ob-btn ob-btn-primary" onclick="obNext()">Next ‚Üí</button>
    </div>
    <button id="obSkipBtn" onclick="obSkip()">Skip tutorial</button>

  </div><!-- /modal -->
</div><!-- /overlay -->

<!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
     3.  JAVASCRIPT
         Paste this AFTER the existing scripts.js <script> tag:
         <script src="{{ url_for('static', filename='js/scripts.js') }}"></script>
         <script> ‚Üê PUT THIS NEW BLOCK HERE
     ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<script id="ob-script">
// ============================================
// ONBOARDING TUTORIAL ‚Äî Hatchly
// ============================================

(function () {
  const OB_KEY = 'hatchly_onboarding_done';
  let obStep = 0;
  const OB_TOTAL = 5;

  function obShouldShow() {
    return !localStorage.getItem(OB_KEY);
  }

  window.obShow = function () {
    obStep = 0;
    document.getElementById('onboardingOverlay').style.display = 'flex';
    _obRender(0);
  };

  function obHide() {
    document.getElementById('onboardingOverlay').style.display = 'none';
    localStorage.setItem(OB_KEY, '1');
  }

  function _obRender(step) {
    // slides
    document.querySelectorAll('.ob-slide').forEach(s => s.classList.remove('active'));
    const slide = document.querySelector(`.ob-slide[data-step="${step}"]`);
    if (slide) slide.classList.add('active');

    // dots
    document.querySelectorAll('.ob-dot').forEach(d => d.classList.remove('active'));
    const dot = document.querySelector(`.ob-dot[data-step="${step}"]`);
    if (dot) dot.classList.add('active');

    // buttons
    const prev = document.getElementById('obPrevBtn');
    const next = document.getElementById('obNextBtn');
    const skip = document.getElementById('obSkipBtn');

    prev.style.display = step === 0 ? 'none' : 'flex';

    if (step === OB_TOTAL - 1) {
      next.textContent = "Let's Start! üöÄ";
      next.classList.remove('ob-btn-primary');
      next.classList.add('ob-btn-success');
      skip.style.display = 'none';
    } else {
      next.textContent = 'Next ‚Üí';
      next.classList.add('ob-btn-primary');
      next.classList.remove('ob-btn-success');
      skip.style.display = 'block';
    }
  }

  window.obNext = function () {
    if (obStep < OB_TOTAL - 1) {
      obStep++;
      _obRender(obStep);
    } else {
      obHide();
      // Kick off the flow: go straight to Dashboard
      if (typeof showPage === 'function') showPage('dashboardPage');
    }
  };

  window.obPrev = function () {
    if (obStep > 0) { obStep--; _obRender(obStep); }
  };

  window.obSkip = function () { obHide(); };

  // Dot click navigation
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.ob-dot').forEach(dot => {
      dot.addEventListener('click', function () {
        obStep = parseInt(this.dataset.step, 10);
        _obRender(obStep);
      });
    });
  });

  // ‚îÄ‚îÄ‚îÄ Hook into login: show tutorial for brand-new accounts ‚îÄ‚îÄ‚îÄ
  // We wait for the existing handleLogin to finish, then check
  // if we just landed on dashboardPage with the flag not set.
  document.addEventListener('DOMContentLoaded', function () {
    // Wrap handleLogin
    if (typeof window.handleLogin === 'function') {
      const _orig = window.handleLogin;
      window.handleLogin = async function (...args) {
        await _orig.apply(this, args);
        setTimeout(function () {
          const dash = document.getElementById('dashboardPage');
          if (dash && dash.classList.contains('active') && obShouldShow()) {
            window.obShow();
          }
        }, 700);
      };
    }

    // Wrap handleSignup: clear the flag so tutorial fires after their first login
    if (typeof window.handleSignup === 'function') {
      const _origSU = window.handleSignup;
      window.handleSignup = async function (...args) {
        localStorage.removeItem(OB_KEY);
        await _origSU.apply(this, args);
      };
    }

    // Catch the case where the user was already logged in (page refresh)
    // and has never seen the tutorial
    setTimeout(function () {
      const dash = document.getElementById('dashboardPage');
      if (dash && dash.classList.contains('active') && obShouldShow()) {
        window.obShow();
      }
    }, 900);
  });
})();
</script>
</body>
</html>