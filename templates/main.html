<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hatchly - Prawn Egg Hatch Prediction System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>

<!-- ============================================
     AUTH PAGE
     ============================================ -->
<div class="page" id="authPage">
    <div class="auth-container">
        <div class="forms-container" id="formsContainer">

            <!-- LOGIN FORM -->
            <div class="form-section">
                <div class="form-content">
                    <div class="branding">
                        <div class="logo-placeholder">
                            <img src="{{ url_for('static', filename='images/Logo.png') }}" alt="Hatchly Logo" class="logo-img">
                        </div>
                        <h1><span class="welcome">Welcome!</span> to Hatchly</h1>
                        <p class="subtitle">Sign in to continue</p>
                    </div>

                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="loginEmail" placeholder="Enter your username">
                        <div class="error" id="loginEmailError">Please enter your username</div>
                    </div>

                    <div class="form-group">
                        <label>Password</label>
                        <div class="password-container">
                            <input type="password" id="loginPassword" placeholder="Enter your password">
                            <span class="toggle-password" onclick="togglePasswordVisibility('loginPassword', this)">Show</span>
                        </div>
                        <div class="error" id="loginPasswordError">Please enter your password</div>
                        <div class="error" id="loginCredentialsError">Wrong username or password. Please try again.</div>
                    </div>

                    <button class="btn" onclick="handleLogin()">LOG IN</button>

                    <div class="switch-text">
                        Don't have an account? <span class="switch-link" onclick="toggleForm()">Sign Up.</span>
                    </div>
                </div>
            </div>

            <!-- SIGNUP FORM -->
            <div class="form-section">
                <div class="form-content">
                    <div class="branding">
                        <h1>Create a new account</h1>
                    </div>

                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" id="signupName" placeholder="Enter your name" maxlength="30">
                        <div class="error" id="signupNameError">Please enter your name</div>
                    </div>

                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="signupEmail" placeholder="Username (6‚Äì15 characters)" maxlength="15">
                        <div class="error" id="signupEmailError">Please enter a username</div>
                    </div>

                    <div class="form-group">
                        <label>Password</label>
                        <div class="password-container">
                            <input type="password" id="signupPassword" placeholder="Create a strong password" maxlength="15"
                                oninput="checkSignupPasswordStrength(this.value)">
                            <span class="toggle-password" onclick="togglePasswordVisibility('signupPassword', this)">Show</span>
                        </div>
                        <div class="error" id="signupPasswordError">Password must be at least 6 characters</div>
                        <div class="strength-bar-wrapper">
                            <div class="strength-bar" id="signupStrengthBar"></div>
                        </div>
                        <p class="strength-label" id="signupStrengthLabel"></p>
                        <ul class="password-requirements">
                            <li id="signup-req-length">At least 6 characters</li>
                            <li id="signup-req-upper">Uppercase letter (A-Z)</li>
                            <li id="signup-req-lower">Lowercase letter (a-z)</li>
                            <li id="signup-req-number">Number (0-9)</li>
                            <li id="signup-req-symbol">Special character (!@#$...)</li>
                        </ul>
                    </div>

                    <div class="form-group">
                        <label>Re-enter Password</label>
                        <div class="password-container">
                            <input type="password" id="signupConfirmPassword" placeholder="Re-enter your password" maxlength="15"
                                oninput="checkSignupPasswordMatch()">
                            <span class="toggle-password" onclick="togglePasswordVisibility('signupConfirmPassword', this)">Show</span>
                        </div>
                        <div class="error" id="signupConfirmPasswordError">Passwords do not match</div>
                        <p class="match-indicator" id="signupMatchIndicator"></p>
                    </div>

                    <button class="btn" onclick="handleSignup()">SIGN UP</button>

                    <div class="switch-text">
                        Already have an account? <span class="switch-link" onclick="toggleForm()">Log In.</span>
                    </div>
                </div>
            </div>

        </div><!-- /forms-container -->
    </div><!-- /auth-container -->
</div><!-- /authPage -->


<!-- ============================================
     DASHBOARD PAGE
     ============================================ -->
<div class="page" id="dashboardPage">
    <div class="logo-top-left" onclick="showPage('dashboardPage')" style="cursor:pointer;">
        <img src="{{ url_for('static', filename='images/Logo.png') }}" alt="Hatchly Logo" class="logo-img">
    </div>

    {% include 'partials/menu.html' ignore missing %}
    <div class="menu-container">
        <button class="btn menu-btn" onclick="toggleMenu()">‚ò∞ Menu</button>
        <div class="menu-dropdown" id="menuDropdownDashboard">
            <div class="menu-header">
                <p class="menu-greeting">Hello <span class="user-name-display">User</span></p>
                <p class="menu-welcome">Welcome to Hatchly</p>
            </div>
            <div class="menu-items">
                <a href="#" onclick="showPage('dashboardPage'); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> Dashboard</a>
                <a href="#" onclick="showChangePassword(); return false;"><img src="{{ url_for('static', filename='images/menu-change.png') }}"> Change Password</a>
                <a href="#" onclick="showPage('selectPrawnPage'); return false;"><img src="{{ url_for('static', filename='images/menu-list.png') }}"> List of Prawns</a>
                <a href="#" onclick="showPage('locationSetupPage'); return false;"><img src="{{ url_for('static', filename='images/menu-location.png') }}"> Location Setup</a>
                <a href="#" onclick="obShow(); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> How to Use</a>
                <a href="#" onclick="handleLogout(); return false;"><img src="{{ url_for('static', filename='images/menu-logout.png') }}"> Logout</a>
            </div>
        </div>
    </div>

    <div class="dashboard-container">
        <h1 class="dashboard-title">Hatchly Dashboard</h1>

        <div class="dashboard-actions">
            <button class="btn"         onclick="showPage('registerPrawnPage')">Register New Prawn</button>
            <button class="btn btn-outline" onclick="showPage('selectPrawnPage')">View All Prawns</button>
        </div>

        <div class="dashboard-stats">
            <div class="stat-card" onclick="showPage('selectPrawnPage')">
                <div class="stat-icon"><img src="{{ url_for('static', filename='images/Total prawn.png') }}"></div>
                <div class="stat-content"><h3 id="totalPrawns">0</h3><p>Total Prawns</p></div>
            </div>
            <div class="stat-card" onclick="document.getElementById('latestPredictionsList').scrollIntoView({behavior:'smooth'})">
                <div class="stat-icon"><img src="{{ url_for('static', filename='images/Total Prediction.png') }}"></div>
                <div class="stat-content"><h3 id="totalPredictions">0</h3><p>Total Predictions</p></div>
            </div>
            <div class="stat-card" onclick="document.getElementById('upcomingHatchesList').scrollIntoView({behavior:'smooth'})">
                <div class="stat-icon"><img src="{{ url_for('static', filename='images/hatching.png') }}"></div>
                <div class="stat-content"><h3 id="upcomingHatches">0</h3><p>Hatching Soon</p></div>
            </div>
        </div>

        <div class="dashboard-two-columns">
            <!-- Pie Chart -->
            <div class="pie-chart-container">
                <h2><img src="{{ url_for('static', filename='images/Pie.png') }}"> Prawns by Location</h2>
                <canvas id="locationPieChart" width="300" height="300" style="max-width:100%;height:auto;"></canvas>
                <div id="pieChartLegend" class="chart-legend"></div>
            </div>
            <!-- Upcoming Hatches -->
            <div class="dashboard-section">
                <h2><img src="{{ url_for('static', filename='images/Upcoming.png') }}"> Upcoming Hatches</h2>
                <div id="upcomingHatchesList" class="upcoming-hatches-list">
                    <p class="loading-text">Loading...</p>
                </div>
            </div>
        </div>

        <!-- Latest Predictions -->
        <div class="dashboard-section">
            <h2><img src="{{ url_for('static', filename='images/Latest.png') }}"> Latest Predictions</h2>
            <div id="latestPredictionsList" class="latest-predictions-grid">
                <p class="loading-text">Loading...</p>
            </div>
        </div>
    </div>
</div><!-- /dashboardPage -->


<!-- ============================================
     REGISTER PRAWN PAGE
     ============================================ -->
<div class="page" id="registerPrawnPage">
    <div class="logo-top-left" onclick="showPage('dashboardPage')" style="cursor:pointer;">
        <img src="{{ url_for('static', filename='images/Logo.png') }}" alt="Hatchly Logo" class="logo-img">
    </div>
    <div class="menu-container">
        <button class="btn menu-btn" onclick="toggleMenu()">‚ò∞ Menu</button>
        <div class="menu-dropdown" id="menuDropdown2">
            <div class="menu-header">
                <p class="menu-greeting">Hello <span class="user-name-display">User</span></p>
                <p class="menu-welcome">Welcome to Hatchly</p>
            </div>
            <div class="menu-items">
                <a href="#" onclick="showPage('dashboardPage'); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> Dashboard</a>
                <a href="#" onclick="showChangePassword(); return false;"><img src="{{ url_for('static', filename='images/menu-change.png') }}"> Change Password</a>
                <a href="#" onclick="showPage('selectPrawnPage'); return false;"><img src="{{ url_for('static', filename='images/menu-list.png') }}"> List of Prawns</a>
                <a href="#" onclick="showPage('locationSetupPage'); return false;"><img src="{{ url_for('static', filename='images/menu-location.png') }}"> Location Setup</a>
                <a href="#" onclick="obShow(); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> How to Use</a>
                <a href="#" onclick="handleLogout(); return false;"><img src="{{ url_for('static', filename='images/menu-logout.png') }}"> Logout</a>
            </div>
        </div>
    </div>

    <div class="register-container">
        <div class="register-header"><h2>Register Prawn</h2></div>

        <div class="form-group">
            <label>Name</label>
            <input type="text" id="prawnName" placeholder="Enter your prawn's name" autocomplete="off" maxlength="20">
            <div class="error" id="prawnNameError">Please enter prawn name</div>
        </div>

        <div class="form-group">
            <label>Location</label>
            <select id="prawnLocation" class="form-select" onchange="
                document.getElementById('prawnLocationError').classList.remove('show');
                this.classList.remove('error-input');
                document.getElementById('inlineLocationError').classList.remove('show');
            ">
                <option value="">-- Select Location --</option>
            </select>
            <div class="error" id="prawnLocationError">Please select a location</div>

            <div class="inline-add-location">
                <p class="inline-add-label">Can't find your location?</p>
                <div class="location-input-row">
                    <input type="text" id="inlineLocationName" placeholder="Type new location name" maxlength="20" autocomplete="off">
                    <button class="btn-add" onclick="handleInlineAddLocation()">ADD</button>
                </div>
                <div class="error" id="inlineLocationError">Please enter a location name</div>
            </div>
        </div>

        <button class="btn btn-outline" onclick="handleSavePrawn()">SAVE</button>
        <button class="btn btn-outline" onclick="showPage('selectPrawnPage')">VIEW PRAWNS</button>
        <button class="btn btn-outline" onclick="goBackFromLocationSetup()">BACK</button>
    </div>
</div><!-- /registerPrawnPage -->


<!-- ============================================
     SELECT PRAWN PAGE
     ============================================ -->
<div class="page" id="selectPrawnPage">
    <div class="logo-top-left" onclick="showPage('dashboardPage')" style="cursor:pointer;">
        <img src="{{ url_for('static', filename='images/Logo.png') }}" alt="Hatchly Logo" class="logo-img">
    </div>
    <div class="menu-container">
        <button class="btn menu-btn" onclick="toggleMenu()">‚ò∞ Menu</button>
        <div class="menu-dropdown" id="menuDropdown3">
            <div class="menu-header">
                <p class="menu-greeting">Hello <span class="user-name-display">User</span></p>
                <p class="menu-welcome">Welcome to Hatchly</p>
            </div>
            <div class="menu-items">
                <a href="#" onclick="showPage('dashboardPage'); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> Dashboard</a>
                <a href="#" onclick="showChangePassword(); return false;"><img src="{{ url_for('static', filename='images/menu-change.png') }}"> Change Password</a>
                <a href="#" onclick="showPage('selectPrawnPage'); return false;"><img src="{{ url_for('static', filename='images/menu-list.png') }}"> List of Prawns</a>
                <a href="#" onclick="showPage('locationSetupPage'); return false;"><img src="{{ url_for('static', filename='images/menu-location.png') }}"> Location Setup</a>
                <a href="#" onclick="obShow(); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> How to Use</a>
                <a href="#" onclick="handleLogout(); return false;"><img src="{{ url_for('static', filename='images/menu-logout.png') }}"> Logout</a>
            </div>
        </div>
    </div>

    <div class="select-container">
        <div class="register-header"><h2>Select Prawn</h2></div>

        <div class="location-filter-row">
            <label>Filter by Location:</label>
            <select id="locationFilter" class="form-select" onchange="filterPrawnsByLocation()">
                <option value="">All Prawns</option>
            </select>
        </div>

        <div class="prawnListContainer" id="prawnListContainer"
            style="max-height:55vh;overflow-y:auto;overflow-x:hidden;padding-right:4px;margin-bottom:16px;">
        </div>

        <button class="btn btn-outline" onclick="showPage('registerPrawnPage')">REGISTER PRAWN</button>
        <button class="btn btn-outline" onclick="showPage('dashboardPage')">BACK</button>
    </div>
</div><!-- /selectPrawnPage -->


<!-- ============================================
     IMAGE SELECTION PAGE
     ============================================ -->
<div class="page" id="imageSelectionPage">
    <div class="logo-top-left" onclick="showPage('dashboardPage')" style="cursor:pointer;">
        <img src="{{ url_for('static', filename='images/Logo.png') }}" alt="Hatchly Logo" class="logo-img">
    </div>
    <div class="menu-container">
        <button class="btn menu-btn" onclick="toggleMenu()">‚ò∞ Menu</button>
        <div class="menu-dropdown" id="menuDropdown4">
            <div class="menu-header">
                <p class="menu-greeting">Hello <span class="user-name-display">User</span></p>
                <p class="menu-welcome">Welcome to Hatchly</p>
            </div>
            <div class="menu-items">
                <a href="#" onclick="showPage('dashboardPage'); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> Dashboard</a>
                <a href="#" onclick="showChangePassword(); return false;"><img src="{{ url_for('static', filename='images/menu-change.png') }}"> Change Password</a>
                <a href="#" onclick="showPage('selectPrawnPage'); return false;"><img src="{{ url_for('static', filename='images/menu-list.png') }}"> List of Prawns</a>
                <a href="#" onclick="showPage('locationSetupPage'); return false;"><img src="{{ url_for('static', filename='images/menu-location.png') }}"> Location Setup</a>
                <a href="#" onclick="obShow(); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> How to Use</a>
                <a href="#" onclick="handleLogout(); return false;"><img src="{{ url_for('static', filename='images/menu-logout.png') }}"> Logout</a>
            </div>
        </div>
    </div>

    <div class="select-container">
        <div class="register-header">
            <div class="prawn-info-header">
                <h2 id="selectedPrawnName">Prawn Name</h2>
                <p id="selectedPrawnLocation">Location: --</p>
                <div class="prawn-quick-actions">
                    <button class="prawn-quick-btn" onclick="showRenamePrawnModal(selectedPrawn)">
                        <img src="{{ url_for('static', filename='images/rename.png') }}">
                    </button>
                    <button class="prawn-quick-btn" onclick="showTransferPrawnModal(selectedPrawn)">
                        <img src="{{ url_for('static', filename='images/changeloc.png') }}">
                    </button>
                </div>
            </div>
        </div>

        <button class="btn btn-outline" onclick="showPage('capturePage')">CAPTURE IMAGE</button>
        <button class="btn btn-outline" onclick="triggerFileUpload()">UPLOAD IMAGE</button>
        <button class="btn"             onclick="showHistoryPage()">HISTORY</button>
        <button class="btn btn-outline" onclick="showPage('selectPrawnPage')" style="margin-top:20px;">BACK</button>
        <input type="file" id="fileInput" accept="image/*" style="display:none;" onchange="handleFileUpload(event)">
    </div>
</div><!-- /imageSelectionPage -->


<!-- ============================================
     CAPTURE PAGE
     ============================================ -->
<div class="page" id="capturePage">
    <div class="logo-top-left" onclick="showPage('dashboardPage')" style="cursor:pointer;">
        <img src="{{ url_for('static', filename='images/Logo.png') }}" alt="Hatchly Logo" class="logo-img">
    </div>
    <div class="menu-container">
        <button class="btn menu-btn" onclick="toggleMenu()">‚ò∞ Menu</button>
        <div class="menu-dropdown" id="menuDropdown5">
            <div class="menu-header">
                <p class="menu-greeting">Hello <span class="user-name-display">User</span></p>
                <p class="menu-welcome">Welcome to Hatchly</p>
            </div>
            <div class="menu-items">
                <a href="#" onclick="showPage('dashboardPage'); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> Dashboard</a>
                <a href="#" onclick="showChangePassword(); return false;"><img src="{{ url_for('static', filename='images/menu-change.png') }}"> Change Password</a>
                <a href="#" onclick="showPage('selectPrawnPage'); return false;"><img src="{{ url_for('static', filename='images/menu-list.png') }}"> List of Prawns</a>
                <a href="#" onclick="showPage('locationSetupPage'); return false;"><img src="{{ url_for('static', filename='images/menu-location.png') }}"> Location Setup</a>
                <a href="#" onclick="obShow(); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> How to Use</a>
                <a href="#" onclick="handleLogout(); return false;"><img src="{{ url_for('static', filename='images/menu-logout.png') }}"> Logout</a>
            </div>
        </div>
    </div>

    <div class="capture-container">
        <div class="register-header">
            <div class="prawn-info-header">
                <h2 class="selected-prawn-name-display">Prawn Name</h2>
                <p class="selected-prawn-location-display">Location: --</p>
            </div>
        </div>

        <div class="single-image-box-wrapper">
            <div class="image-box single-image-box" id="singleCameraBox">
                <div id="cameraPlaceholder" class="camera-placeholder">
                    <span>üì∑</span>
                    <p>Select a camera source below to start</p>
                </div>
                <div id="cameraLoading" class="camera-loading" style="display:none;">
                    <div class="spinner"></div>
                    <p>Starting camera...</p>
                </div>
                <video id="video" autoplay playsinline style="display:none;"></video>
                <img   id="rpiStream" style="display:none;">
                <canvas id="canvas"  style="display:none;"></canvas>
                <img   id="capturedImage" style="display:none;">
            </div>
        </div>

        <div class="camera-source-selector">
            <button class="btn btn-outline active-camera" id="useLocalCamera" onclick="switchToLocalCamera()">USE LOCAL CAMERA</button>
            <button class="btn btn-outline"               id="useRPiCamera"   onclick="switchToRPiCamera()">USE PRAWN CAMERA</button>
        </div>

        <div class="button-group">
            <button class="btn"            onclick="navigateBack()">BACK</button>
            <button class="btn btn-orange" id="captureBtn" onclick="captureImage()">CAPTURE</button>
        </div>
    </div>
</div><!-- /capturePage -->


<!-- ============================================
     PREDICT PAGE
     ============================================ -->
<div class="page" id="predictPage">
    <div class="logo-top-left" onclick="showPage('dashboardPage')" style="cursor:pointer;">
        <img src="{{ url_for('static', filename='images/Logo.png') }}" alt="Hatchly Logo" class="logo-img">
    </div>
    <div class="menu-container">
        <button class="btn menu-btn" onclick="toggleMenu()">‚ò∞ Menu</button>
        <div class="menu-dropdown" id="menuDropdown6">
            <div class="menu-header">
                <p class="menu-greeting">Hello <span class="user-name-display">User</span></p>
                <p class="menu-welcome">Welcome to Hatchly</p>
            </div>
            <div class="menu-items">
                <a href="#" onclick="showPage('dashboardPage'); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> Dashboard</a>
                <a href="#" onclick="showChangePassword(); return false;"><img src="{{ url_for('static', filename='images/menu-change.png') }}"> Change Password</a>
                <a href="#" onclick="showPage('selectPrawnPage'); return false;"><img src="{{ url_for('static', filename='images/menu-list.png') }}"> List of Prawns</a>
                <a href="#" onclick="showPage('locationSetupPage'); return false;"><img src="{{ url_for('static', filename='images/menu-location.png') }}"> Location Setup</a>
                <a href="#" onclick="obShow(); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> How to Use</a>
                <a href="#" onclick="handleLogout(); return false;"><img src="{{ url_for('static', filename='images/menu-logout.png') }}"> Logout</a>
            </div>
        </div>
    </div>

    <div class="capture-container">
        <div class="register-header">
            <div class="prawn-info-header">
                <h2 class="selected-prawn-name-display">Prawn Name</h2>
                <p class="selected-prawn-location-display">Location: --</p>
            </div>
        </div>

        <div class="image-preview-container">
            <div class="image-box">
                <img id="uploadedImage" src="" alt="Uploaded image">
            </div>
            <div class="image-box preview-box">
                <div id="predictionResult" class="prediction-result">
                    <div id="loadingSpinner" style="display:none;">
                        <div class="spinner"></div>
                        <p>Analyzing image...</p>
                    </div>
                    <div id="resultContent" style="display:none;">
                        <h3>Prediction Result</h3>
                        <p class="result-days"><span id="daysResult">--</span> days until hatch</p>
                        <p class="result-confidence">Confidence: <span id="confidenceResult">--</span>%</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="button-group" id="predictBtnGroup">
            <button class="btn"            onclick="tryAgain()">BACK</button>
            <button class="btn btn-orange" id="predictBtn" onclick="predictHatchDate()">PREDICT RESULT</button>
        </div>
    </div>
</div><!-- /predictPage -->


<!-- ============================================
     HISTORY PAGE
     ============================================ -->
<div class="page" id="historyPage">
    <div class="logo-top-left" onclick="showPage('dashboardPage')" style="cursor:pointer;">
        <img src="{{ url_for('static', filename='images/Logo.png') }}" alt="Hatchly Logo" class="logo-img">
    </div>
    <div class="menu-container">
        <button class="btn menu-btn" onclick="toggleMenu()">‚ò∞ Menu</button>
        <div class="menu-dropdown" id="menuDropdown7">
            <div class="menu-header">
                <p class="menu-greeting">Hello <span class="user-name-display">User</span></p>
                <p class="menu-welcome">Welcome to Hatchly</p>
            </div>
            <div class="menu-items">
                <a href="#" onclick="showPage('dashboardPage'); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> Dashboard</a>
                <a href="#" onclick="showChangePassword(); return false;"><img src="{{ url_for('static', filename='images/menu-change.png') }}"> Change Password</a>
                <a href="#" onclick="showPage('selectPrawnPage'); return false;"><img src="{{ url_for('static', filename='images/menu-list.png') }}"> List of Prawns</a>
                <a href="#" onclick="showPage('locationSetupPage'); return false;"><img src="{{ url_for('static', filename='images/menu-location.png') }}"> Location Setup</a>
                <a href="#" onclick="obShow(); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> How to Use</a>
                <a href="#" onclick="handleLogout(); return false;"><img src="{{ url_for('static', filename='images/menu-logout.png') }}"> Logout</a>
            </div>
        </div>
    </div>

    <div class="history-container">
        <h2 class="history-title"><span id="prawnNameTitle">Prawn Name</span> Logs</h2>

        <div class="history-filter-row">
            <select id="historyDateFilter" class="form-select" onchange="filterHistoryLogs()" style="max-width:200px;">
                <option value="all">All Time</option>
                <option value="7">Last 7 Days</option>
                <option value="30">Last 30 Days</option>
                <option value="90">Last 3 Months</option>
            </select>
        </div>

        <div class="logs-container" id="logsContainer"></div>

        <button class="btn" onclick="showPage('imageSelectionPage')" style="max-width:300px;margin:30px auto 0;display:block;">BACK</button>
    </div>
</div><!-- /historyPage -->


<!-- ============================================
     CHANGE PASSWORD PAGE
     ============================================ -->
<div class="page" id="changePasswordPage">
    <div class="logo-top-left" onclick="showPage('dashboardPage')" style="cursor:pointer;">
        <img src="{{ url_for('static', filename='images/Logo.png') }}" alt="Hatchly Logo" class="logo-img">
    </div>
    <div class="menu-container">
        <button class="btn menu-btn" onclick="toggleMenu()">‚ò∞ Menu</button>
        <div class="menu-dropdown" id="menuDropdown8">
            <div class="menu-header">
                <p class="menu-greeting">Hello <span class="user-name-display">User</span></p>
                <p class="menu-welcome">Welcome to Hatchly</p>
            </div>
            <div class="menu-items">
                <a href="#" onclick="showPage('dashboardPage'); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> Dashboard</a>
                <a href="#" onclick="showChangePassword(); return false;"><img src="{{ url_for('static', filename='images/menu-change.png') }}"> Change Password</a>
                <a href="#" onclick="showPage('selectPrawnPage'); return false;"><img src="{{ url_for('static', filename='images/menu-list.png') }}"> List of Prawns</a>
                <a href="#" onclick="showPage('locationSetupPage'); return false;"><img src="{{ url_for('static', filename='images/menu-location.png') }}"> Location Setup</a>
                <a href="#" onclick="obShow(); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> How to Use</a>
                <a href="#" onclick="handleLogout(); return false;"><img src="{{ url_for('static', filename='images/menu-logout.png') }}"> Logout</a>
            </div>
        </div>
    </div>

    <div class="register-container">
        <div class="change-password-header"><h2>Change Password</h2></div>

        <div class="form-group">
            <label>Current Password</label>
            <div class="password-container">
                <input type="password" id="currentPassword" placeholder="Enter current password">
                <span class="toggle-password" onclick="togglePasswordVisibility('currentPassword', this)">Show</span>
            </div>
            <div class="error" id="currentPasswordError">Please enter your current password</div>
        </div>

        <div class="form-group">
            <label>New Password</label>
            <div class="password-container">
                <input type="password" id="newPassword" placeholder="Enter new password"
                    oninput="checkPasswordStrength(this.value)">
                <span class="toggle-password" onclick="togglePasswordVisibility('newPassword', this)">Show</span>
            </div>
            <div class="error" id="newPasswordError">Password must be at least 6 characters</div>
            <div class="strength-bar-wrapper">
                <div class="strength-bar" id="strengthBar"></div>
            </div>
            <p class="strength-label" id="strengthLabel"></p>
            <ul class="password-requirements">
                <li id="req-length">At least 6 characters</li>
                <li id="req-upper">Uppercase letter (A-Z)</li>
                <li id="req-lower">Lowercase letter (a-z)</li>
                <li id="req-number">Number (0-9)</li>
                <li id="req-symbol">Special character (!@#$...)</li>
            </ul>
        </div>

        <div class="form-group">
            <label>Confirm New Password</label>
            <div class="password-container">
                <input type="password" id="confirmPassword" placeholder="Confirm new password"
                    oninput="checkPasswordMatch()">
                <span class="toggle-password" onclick="togglePasswordVisibility('confirmPassword', this)">Show</span>
            </div>
            <div class="error" id="confirmPasswordError">Passwords do not match</div>
            <p class="match-indicator" id="matchIndicator"></p>
        </div>

        <button class="btn btn-outline" onclick="handleChangePassword()">CHANGE PASSWORD</button>
        <button class="btn btn-outline" onclick="showPage('dashboardPage')">CANCEL</button>
    </div>
</div><!-- /changePasswordPage -->


<!-- ============================================
     LOCATION SETUP PAGE
     ============================================ -->
<div class="page" id="locationSetupPage">
    <div class="logo-top-left" onclick="showPage('dashboardPage')" style="cursor:pointer;">
        <img src="{{ url_for('static', filename='images/Logo.png') }}" alt="Hatchly Logo" class="logo-img">
    </div>
    <div class="menu-container">
        <button class="btn menu-btn" onclick="toggleMenu()">‚ò∞ Menu</button>
        <div class="menu-dropdown" id="menuDropdownLocation">
            <div class="menu-header">
                <p class="menu-greeting">Hello <span class="user-name-display">User</span></p>
                <p class="menu-welcome">Welcome to Hatchly</p>
            </div>
            <div class="menu-items">
                <a href="#" onclick="showPage('dashboardPage'); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> Dashboard</a>
                <a href="#" onclick="showChangePassword(); return false;"><img src="{{ url_for('static', filename='images/menu-change.png') }}"> Change Password</a>
                <a href="#" onclick="showPage('selectPrawnPage'); return false;"><img src="{{ url_for('static', filename='images/menu-list.png') }}"> List of Prawns</a>
                <a href="#" onclick="showPage('locationSetupPage'); return false;"><img src="{{ url_for('static', filename='images/menu-location.png') }}"> Location Setup</a>
                <a href="#" onclick="obShow(); return false;"><img src="{{ url_for('static', filename='images/menu-dashboard.png') }}"> How to Use</a>
                <a href="#" onclick="handleLogout(); return false;"><img src="{{ url_for('static', filename='images/menu-logout.png') }}"> Logout</a>
            </div>
        </div>
    </div>

    <div class="register-container">
        <div class="register-header"><h2>Location Setup</h2></div>

        <div class="form-group">
            <label>Add New Location</label>
            <div class="location-input-row">
                <input type="text" id="newLocationName" placeholder="Enter location name" autocomplete="off" maxlength="20">
                <button class="btn-add" onclick="handleAddLocation()">ADD</button>
            </div>
            <div class="error" id="locationNameError">Please enter a location name</div>
        </div>

        <div class="location-list-header"><h3>Your Locations</h3></div>
        <div id="locationListContainer" class="location-list-container">
            <p style="text-align:center;color:#666;">Loading...</p>
        </div>

        <button class="btn btn-outline" onclick="goBackFromLocationSetup()" style="margin-top:20px;">BACK</button>
    </div>
</div><!-- /locationSetupPage -->


<!-- ============================================
     IMAGE MODAL
     ============================================ -->
<div class="modal" id="imageModal" onclick="closeImageModal()">
    <span class="close-modal">&times;</span>
    <img class="modal-content" id="modalImage">
</div>


<!-- ============================================
     DELETE PRAWN MODAL
     ============================================ -->
<div class="modal" id="deletePrawnModal" onclick="closeDeleteModal(event)">
    <div class="delete-modal-content" onclick="event.stopPropagation()">
        <span class="close-modal" onclick="closeDeleteModal()">&times;</span>
        <h2>‚ö†Ô∏è Delete Prawn</h2>
        <p class="delete-warning">Are you sure you want to delete "<span id="deletePrawnName"></span>"?</p>
        <p class="delete-info">This action cannot be undone. All prediction history for this prawn will also be deleted.</p>
        <div class="form-group">
            <label>Enter your password to confirm:</label>
            <div class="password-container">
                <input type="password" id="deleteConfirmPassword" placeholder="Enter your password">
                <span class="toggle-password" onclick="togglePasswordVisibility('deleteConfirmPassword', this)">Show</span>
            </div>
            <div class="error" id="deletePasswordError">Password is incorrect</div>
        </div>
        <div class="button-group">
            <button class="btn btn-outline" onclick="closeDeleteModal()">CANCEL</button>
            <button class="btn btn-delete"  onclick="confirmDeletePrawn()">DELETE PRAWN</button>
        </div>
    </div>
</div>


<!-- ============================================
     RENAME PRAWN MODAL
     ============================================ -->
<div class="modal" id="renamePrawnModal" onclick="closeRenamePrawnModal(event)">
    <div class="delete-modal-content" onclick="event.stopPropagation()">
        <span class="close-modal" onclick="closeRenamePrawnModal()">&times;</span>
        <h2>Rename Prawn</h2>
        <p class="delete-warning">Current name: <strong><span id="renamePrawnCurrentName"></span></strong></p>
        <div class="form-group">
            <label>New Name</label>
            <input type="text" id="renamePrawnInput" placeholder="Enter new prawn name" autocomplete="off" maxlength="20">
            <div class="error" id="renamePrawnError">Please enter a name</div>
        </div>
        <div class="button-group">
            <button class="btn btn-outline" onclick="closeRenamePrawnModal()">CANCEL</button>
            <button class="btn btn-orange"  onclick="confirmRenamePrawn()">SAVE</button>
        </div>
    </div>
</div>


<!-- ============================================
     TRANSFER PRAWN MODAL
     ============================================ -->
<div class="modal" id="transferPrawnModal" onclick="closeTransferPrawnModal(event)">
    <div class="delete-modal-content" onclick="event.stopPropagation()">
        <span class="close-modal" onclick="closeTransferPrawnModal()">&times;</span>
        <h2>Change Location</h2>
        <p class="delete-warning">"<span id="transferPrawnName"></span>"</p>
        <p class="transfer-current-location">Current: <strong><span id="transferCurrentLocation"></span></strong></p>
        <div class="form-group" style="margin-top:16px;">
            <label>Move to</label>
            <select id="transferLocationSelect" class="form-select">
                <option value="">-- Select Location --</option>
            </select>
            <div class="error" id="transferLocationError">Please select a location</div>
        </div>
        <div class="button-group">
            <button class="btn btn-outline" onclick="closeTransferPrawnModal()">CANCEL</button>
            <button class="btn btn-orange"  onclick="confirmTransferPrawn()">CHANGE</button>
        </div>
    </div>
</div>


<!-- ============================================
     REASSIGN LOCATION MODAL
     ============================================ -->
<div class="modal" id="reassignLocationModal" onclick="closeReassignModal(event)">
    <div class="delete-modal-content" onclick="event.stopPropagation()">
        <span class="close-modal" onclick="closeReassignModal()">&times;</span>
        <h2>üìç Delete Location</h2>
        <p class="delete-warning">Location has <strong><span id="reassignPrawnCount"></span> prawn(s)</strong> assigned.</p>
        <p class="delete-info">Select a new location for these prawns before deleting.</p>
        <div class="form-group" style="margin-top:16px;">
            <label>Transfer prawns to</label>
            <select id="reassignLocationSelect" class="form-select">
                <option value="">-- Select Location --</option>
            </select>
            <div class="error" id="reassignLocationError">Please select a location</div>
        </div>
        <div class="button-group">
            <button class="btn btn-outline" onclick="closeReassignModal()">CANCEL</button>
            <button class="btn btn-delete"  onclick="confirmReassignAndDelete()">TRANSFER & DELETE</button>
        </div>
    </div>
</div>


<!-- ============================================
     RENAME LOCATION MODAL
     ============================================ -->
<div class="modal" id="renameLocationModal" onclick="closeRenameModal(event)">
    <div class="delete-modal-content" onclick="event.stopPropagation()">
        <span class="close-modal" onclick="closeRenameModal()">&times;</span>
        <h2>‚úèÔ∏è Rename Location</h2>
        <div class="form-group">
            <label>New Name</label>
            <input type="text" id="renameLocationInput" placeholder="Enter new location name" autocomplete="off" maxlength="20">
            <div class="error" id="renameLocationError">Please enter a name</div>
        </div>
        <div class="button-group">
            <button class="btn btn-outline" onclick="closeRenameModal()">CANCEL</button>
            <button class="btn btn-orange"  onclick="confirmRenameLocation()">RENAME</button>
        </div>
    </div>
</div>


<!-- ============================================
     ONBOARDING TUTORIAL
     ============================================ -->
<div id="onboardingOverlay" style="display:none;">
    <div id="onboardingBackdrop"></div>
    <div id="onboardingModal">

        <div id="onboardingDots">
            <span class="ob-dot active" data-step="0"></span>
            <span class="ob-dot"        data-step="1"></span>
            <span class="ob-dot"        data-step="2"></span>
            <span class="ob-dot"        data-step="3"></span>
            <span class="ob-dot"        data-step="4"></span>
        </div>

        <div id="onboardingSlides">

            <!-- SLIDE 0: Welcome -->
            <div class="ob-slide active" data-step="0">
                <div class="ob-icon-wrap">
                    <div class="ob-shrimp-icon">ü¶ê</div>
                    <div class="ob-ripple r1"></div>
                    <div class="ob-ripple r2"></div>
                    <div class="ob-ripple r3"></div>
                </div>
                <h2 class="ob-title">Welcome to <span>Hatchly!</span></h2>
                <p class="ob-desc">Your smart prawn egg hatch prediction system. Let's walk you through the quick setup ‚Äî it only takes a minute!</p>
                <div class="ob-badge">First-time setup üéâ</div>
            </div>

            <!-- SLIDE 1: Register Prawn -->
            <div class="ob-slide" data-step="1">
                <div class="ob-step-num">Step 1</div>
                <div class="ob-icon-wrap small"><div class="ob-emoji">üìã</div></div>
                <h2 class="ob-title">Register Your <span>Prawn</span></h2>
                <p class="ob-desc">Start by registering your first prawn. Add a location first before saving.</p>
                <div class="ob-steps-mini">
                    <div class="ob-mini-step"><span class="ob-mini-num">1</span><span>Click <em>Register New Prawn</em> from the Dashboard</span></div>
                    <div class="ob-mini-step"><span class="ob-mini-num">2</span><span>Enter your prawn's name</span></div>
                    <div class="ob-mini-step"><span class="ob-mini-num">3</span><span>Type a location in the <em>Can't find your location?</em> box ‚Üí click <em>ADD</em></span></div>
                    <div class="ob-mini-step"><span class="ob-mini-num">4</span><span>Or go to <em>Menu ‚Üí Location Setup</em> to manage all locations</span></div>
                    <div class="ob-mini-step"><span class="ob-mini-num">5</span><span>Select the location from the dropdown ‚Üí click <em>SAVE</em></span></div>
                </div>
            </div>

            <!-- SLIDE 2: Select Prawn -->
            <div class="ob-slide" data-step="2">
                <div class="ob-step-num">Step 2</div>
                <div class="ob-icon-wrap small"><div class="ob-emoji">üëÜ</div></div>
                <h2 class="ob-title">Select Your <span>Prawn</span></h2>
                <p class="ob-desc">After saving you'll land on the <strong>Select Prawn</strong> page. Tap the prawn card you just created to open its options.</p>
                <div class="ob-visual-card">
                    <div class="ob-fake-card">
                        <div class="ob-fake-card-left">
                            <div class="ob-fake-title">My Prawn</div>
                            <div class="ob-fake-sub">üìç Aquarium A</div>
                        </div>
                        <div class="ob-fake-arrow">‚Ä∫</div>
                    </div>
                    <div class="ob-tap-hint">‚Üê tap this card!</div>
                </div>
            </div>

            <!-- SLIDE 3: Get a Prediction -->
            <div class="ob-slide" data-step="3">
                <div class="ob-step-num">Step 3</div>
                <div class="ob-icon-wrap small"><div class="ob-emoji">üì∏</div></div>
                <h2 class="ob-title">Get a <span>Prediction</span></h2>
                <p class="ob-desc">After selecting a prawn, choose how to provide the egg image.</p>
                <div class="ob-two-options">
                    <div class="ob-option">
                        <div class="ob-option-icon">üì∑</div>
                        <div class="ob-option-label">CAPTURE IMAGE</div>
                        <div class="ob-option-hint">Use <em>Local Camera</em> (your device) or <em>Prawn Camera</em> (RPi)</div>
                    </div>
                    <div class="ob-option-divider">or</div>
                    <div class="ob-option">
                        <div class="ob-option-icon">üñºÔ∏è</div>
                        <div class="ob-option-label">UPLOAD IMAGE</div>
                        <div class="ob-option-hint">Choose an existing photo from your gallery</div>
                    </div>
                </div>
                <p class="ob-desc small">Then tap <strong>PREDICT RESULT</strong> to get the estimated days until hatch. Results are saved automatically!</p>
            </div>

            <!-- SLIDE 4: History & Dashboard -->
            <div class="ob-slide" data-step="4">
                <div class="ob-step-num">Step 4</div>
                <div class="ob-icon-wrap small"><div class="ob-emoji">üìä</div></div>
                <h2 class="ob-title">Track Your <span>History</span></h2>
                <p class="ob-desc">All predictions are saved automatically. Tap <strong>HISTORY</strong> from the prawn options page to review all logs.</p>
                <div class="ob-history-preview">
                    <div class="ob-fake-log">
                        <div class="ob-fake-log-info">
                            <div class="ob-fake-log-date">üìÖ Feb 26, 2026 ¬∑ 09:41 AM</div>
                            <div class="ob-fake-log-days">üïê <strong>7 days</strong> before hatching</div>
                        </div>
                        <div class="ob-fake-log-img">ü¶ê</div>
                    </div>
                </div>
                <div class="ob-dashboard-note">üí° Your <strong>Dashboard</strong> shows upcoming hatches &amp; latest predictions at a glance!</div>
            </div>

        </div><!-- /onboardingSlides -->

        <div id="onboardingNav">
            <button id="obPrevBtn" class="ob-btn ob-btn-ghost"   onclick="obPrev()">‚Üê Back</button>
            <button id="obNextBtn" class="ob-btn ob-btn-primary" onclick="obNext()">Next ‚Üí</button>
        </div>
        <button id="obSkipBtn" onclick="obSkip()">Skip tutorial</button>

    </div><!-- /onboardingModal -->
</div><!-- /onboardingOverlay -->


<!-- ============================================
     SCRIPTS
     ============================================ -->
<script src="{{ url_for('static', filename='js/scripts.js') }}"></script>
<script>
    const deleteIconUrl = "{{ url_for('static', filename='images/delete.png') }}";
</script>

<script>
// ============================================
// ONBOARDING TUTORIAL
// ============================================
(function () {
    const OB_KEY  = 'hatchly_onboarding_done';
    const OB_TOTAL = 5;
    let obStep    = 0;

    function obShouldShow() { return !localStorage.getItem(OB_KEY); }

    window.obShow = function () {
        obStep = 0;
        document.getElementById('onboardingOverlay').style.display = 'flex';
        _obRender(0);
    };

    function obHide() {
        document.getElementById('onboardingOverlay').style.display = 'none';
        localStorage.setItem(OB_KEY, '1');
    }

    function _obRender(step) {
        document.querySelectorAll('.ob-slide').forEach(s => s.classList.remove('active'));
        document.querySelector(`.ob-slide[data-step="${step}"]`)?.classList.add('active');

        document.querySelectorAll('.ob-dot').forEach(d => d.classList.remove('active'));
        document.querySelector(`.ob-dot[data-step="${step}"]`)?.classList.add('active');

        const prev = document.getElementById('obPrevBtn');
        const next = document.getElementById('obNextBtn');
        const skip = document.getElementById('obSkipBtn');

        prev.style.display = step === 0 ? 'none' : 'flex';

        if (step === OB_TOTAL - 1) {
            next.textContent = "Let's Start! üöÄ";
            next.classList.replace('ob-btn-primary', 'ob-btn-success');
            skip.style.display = 'none';
        } else {
            next.textContent = 'Next ‚Üí';
            next.classList.replace('ob-btn-success', 'ob-btn-primary');
            skip.style.display = 'block';
        }
    }

    window.obNext = function () {
        if (obStep < OB_TOTAL - 1) { obStep++; _obRender(obStep); }
        else { obHide(); if (typeof showPage === 'function') showPage('dashboardPage'); }
    };

    window.obPrev = function () { if (obStep > 0) { obStep--; _obRender(obStep); } };
    window.obSkip = function () { obHide(); };

    document.addEventListener('DOMContentLoaded', function () {
        // Dot click navigation
        document.querySelectorAll('.ob-dot').forEach(dot => {
            dot.addEventListener('click', function () {
                obStep = parseInt(this.dataset.step, 10);
                _obRender(obStep);
            });
        });

        // Show after login
        if (typeof window.handleLogin === 'function') {
            const _orig = window.handleLogin;
            window.handleLogin = async function (...args) {
                await _orig.apply(this, args);
                setTimeout(function () {
                    const dash = document.getElementById('dashboardPage');
                    if (dash?.classList.contains('active') && obShouldShow()) window.obShow();
                }, 700);
            };
        }

        // Reset tutorial on new signup
        if (typeof window.handleSignup === 'function') {
            const _origSU = window.handleSignup;
            window.handleSignup = async function (...args) {
                localStorage.removeItem(OB_KEY);
                await _origSU.apply(this, args);
            };
        }

        // Show on page load if already on dashboard
        setTimeout(function () {
            const dash = document.getElementById('dashboardPage');
            if (dash?.classList.contains('active') && obShouldShow()) window.obShow();
        }, 900);
    });
})();
</script>

</body>
</html>